// polyfills for Android 5.0
import 'core-js/features/map';
import 'core-js/features/set';

import React from 'react';
import ReactDOM from 'react-dom';
import { setupConfig } from '@ionic/react';
import appModel from 'app_model';
import userModel from 'user_model';
import savedSamples from 'saved_samples';
import Analytics from 'helpers/analytics';
import App from './App';

import '../test/manual-test-utils';


const coords = [
  [7.88874, 47.90533],
  [7.88804, 47.90508],
  [7.88759, 47.90488],
  [7.8869, 47.90463],
  [7.8866, 47.90459],
  [7.88601, 47.90439],
  [7.88575, 47.90433],
  [7.88545, 47.90421],
  [7.88502, 47.90412],
  [7.88481, 47.9041],
  [7.88461, 47.90402],
  [7.88446, 47.90401],
  [7.88362, 47.90421],
  [7.88323, 47.90423],
  [7.8826, 47.90432],
  [7.88221, 47.90434],
  [7.88141, 47.90432],
  [7.88119, 47.90433],
  [7.88085, 47.9043],
  [7.88063, 47.90422],
  [7.88039, 47.90423],
  [7.87988, 47.90419],
  [7.87957, 47.90412],
  [7.87835, 47.90408],
  [7.87747, 47.9039],
  [7.87674, 47.9038],
  [7.87609, 47.90375],
  [7.8758, 47.90371],
  [7.87519, 47.90367],
  [7.87501, 47.90362],
  [7.87452, 47.90339],
  [7.87426, 47.90322],
  [7.8738, 47.90297],
  [7.87365, 47.90291],
  [7.87332, 47.9028],
  [7.87265, 47.90253],
  [7.87252, 47.90249],
  [7.87244, 47.90249],
  [7.87204, 47.90236],
  [7.87169, 47.90229],
  [7.87144, 47.90219],
  [7.87105, 47.90208],
  [7.87084, 47.90198],
  [7.87021, 47.90205],
  [7.86985, 47.90201],
  [7.86967, 47.90195],
  [7.86959, 47.90195],
  [7.86938, 47.90202],
  [7.8693, 47.90201],
  [7.86911, 47.90203],
  [7.86893, 47.90202],
  [7.86841, 47.90186],
  [7.86761, 47.90167],
  [7.86736, 47.9015],
  [7.86722, 47.90145],
  [7.86703, 47.90143],
  [7.86692, 47.90139],
  [7.8668, 47.9013],
  [7.86666, 47.90114],
  [7.86644, 47.90105],
  [7.86546, 47.90093],
  [7.86401, 47.90068],
  [7.86368, 47.9006],
  [7.86347, 47.90059],
  [7.86304, 47.90049],
  [7.86272, 47.9004],
  [7.86238, 47.90026],
  [7.86162, 47.90005],
  [7.86139, 47.90002],
  [7.861, 47.8999],
  [7.86053, 47.89973],
  [7.86052, 47.89967],
  [7.86019, 47.89954],
  [7.8589, 47.89935],
  [7.85864, 47.89934],
  [7.85835, 47.89929],
  [7.85811, 47.89922],
  [7.85764, 47.89915],
  [7.85712, 47.89911],
  [7.85682, 47.89901],
  [7.85642, 47.89891],
  [7.85628, 47.89892],
  [7.85505, 47.8988],
  [7.85474, 47.89874],
  [7.85392, 47.8987],
  [7.853, 47.89854],
  [7.85258, 47.89856],
  [7.85181, 47.89843],
  [7.85154, 47.89833],
  [7.85132, 47.89819],
  [7.85067, 47.89791],
  [7.85019, 47.89761],
  [7.8497, 47.89734],
  [7.84959, 47.89719],
  [7.84947, 47.89692],
  [7.84935, 47.89678],
  [7.84922, 47.89657],
  [7.84871, 47.89606],
  [7.84863, 47.89602],
  [7.84844, 47.89583],
  [7.84818, 47.89567],
  [7.84798, 47.89558],
  [7.84777, 47.89557],
  [7.84731, 47.8955],
  [7.84685, 47.89538],
  [7.84669, 47.8953],
  [7.84636, 47.89505],
  [7.84626, 47.89495],
  [7.84605, 47.89462],
  [7.84605, 47.89434],
  [7.8461, 47.89414],
  [7.84612, 47.89394],
  [7.84603, 47.89378],
  [7.84568, 47.89337],
  [7.84545, 47.89315],
  [7.84529, 47.89302],
  [7.84495, 47.89279],
  [7.84438, 47.89248],
  [7.84349, 47.89193],
  [7.84339, 47.89184],
  [7.84333, 47.89174],
  [7.84312, 47.89149],
  [7.84237, 47.89093],
  [7.84226, 47.89081],
  [7.84224, 47.89076],
  [7.84219, 47.8904],
  [7.84208, 47.89011],
  [7.84207, 47.89002],
  [7.84201, 47.88988],
  [7.84192, 47.88981],
  [7.84135, 47.88974],
  [7.84084, 47.88961],
  [7.84019, 47.88928],
  [7.83975, 47.88893],
  [7.83954, 47.88879],
  [7.83844, 47.88846],
  [7.83783, 47.88845],
  [7.83764, 47.88847],
  [7.83709, 47.88859],
  [7.83698, 47.88859],
  [7.83596, 47.88843],
  [7.83526, 47.88819],
  [7.83468, 47.88794],
  [7.83423, 47.88766],
  [7.83394, 47.88745],
  [7.83362, 47.88726],
  [7.83326, 47.88708],
  [7.83271, 47.88686],
  [7.83229, 47.88666],
  [7.83193, 47.88646],
  [7.83112, 47.88597],
  [7.83007, 47.88546],
  [7.82965, 47.88527],
  [7.82958, 47.88526],
  [7.82942, 47.88519],
  [7.82921, 47.88505],
  [7.82905, 47.88499],
  [7.82888, 47.88498],
  [7.82852, 47.88513],
  [7.82832, 47.88518],
  [7.82798, 47.88519],
  [7.82765, 47.88527],
  [7.82733, 47.88531],
  [7.82697, 47.8853],
  [7.82602, 47.88515],
  [7.82571, 47.88508],
  [7.82532, 47.88503],
  [7.8248, 47.88507],
  [7.8244, 47.88513],
  [7.82419, 47.88519],
  [7.82389, 47.88521],
  [7.82356, 47.88528],
  [7.82326, 47.88528],
  [7.82302, 47.88526],
  [7.82263, 47.8853],
  [7.82215, 47.88517],
  [7.82195, 47.88518],
  [7.82169, 47.88513],
  [7.82129, 47.88499],
  [7.82108, 47.8849],
  [7.82024, 47.88481],
  [7.8198, 47.88473],
  [7.81968, 47.88469],
  [7.81928, 47.8843],
  [7.81888, 47.88399],
  [7.8187, 47.88388],
  [7.8185, 47.88379],
  [7.81757, 47.88351],
  [7.81733, 47.88342],
  [7.81697, 47.88322],
  [7.81648, 47.88286],
  [7.81621, 47.88263],
  [7.8161, 47.8825],
  [7.81607, 47.88236],
  [7.81619, 47.88198],
  [7.81616, 47.88192],
  [7.81604, 47.88174],
  [7.81599, 47.8817],
  [7.81577, 47.88159],
  [7.81556, 47.88155],
  [7.8147, 47.88154],
  [7.81411, 47.88141],
  [7.81389, 47.88132],
  [7.8137, 47.8812],
  [7.81358, 47.88106],
  [7.81349, 47.88078],
  [7.8134, 47.88071],
  [7.81298, 47.88061],
  [7.81253, 47.88055],
  [7.81188, 47.88056],
  [7.81125, 47.88072],
  [7.81096, 47.88073],
  [7.81069, 47.88069],
  [7.81035, 47.88057],
  [7.80996, 47.8803],
  [7.80977, 47.8802],
  [7.80957, 47.88016],
  [7.80935, 47.88016],
  [7.80875, 47.8802],
  [7.80841, 47.88015],
  [7.80816, 47.88015],
  [7.80777, 47.87988],
  [7.80748, 47.87958],
  [7.80731, 47.87956],
  [7.80707, 47.87949],
  [7.80692, 47.87943],
  [7.80567, 47.87905],
  [7.80546, 47.879],
  [7.80496, 47.87893],
  [7.80463, 47.87882],
  [7.80451, 47.87876],
  [7.8044, 47.87862],
  [7.80425, 47.87833],
  [7.80409, 47.8782],
  [7.80349, 47.87792],
  [7.80316, 47.87781],
  [7.80298, 47.87771],
  [7.80278, 47.87757],
  [7.80264, 47.8774],
  [7.80262, 47.87726],
  [7.8027, 47.87701],
  [7.8029, 47.87676],
  [7.8032, 47.87653],
  [7.80322, 47.87647],
  [7.8032, 47.87637],
  [7.80322, 47.87621],
  [7.80317, 47.87611],
  [7.80311, 47.87604],
  [7.80285, 47.87589],
  [7.80242, 47.87572],
  [7.80191, 47.87543],
  [7.80171, 47.87537],
  [7.8016, 47.87539],
  [7.80144, 47.87545],
  [7.80129, 47.87547],
  [7.8011, 47.87545],
  [7.80078, 47.8755],
  [7.80002, 47.87542],
  [7.79955, 47.87533],
  [7.79926, 47.87533],
  [7.79847, 47.87548],
  [7.79811, 47.87552],
  [7.79788, 47.8755],
  [7.79739, 47.87542],
  [7.79721, 47.87548],
  [7.79706, 47.87551],
  [7.79651, 47.87551],
  [7.79588, 47.87557],
  [7.79511, 47.8755],
  [7.79436, 47.87564],
  [7.79251, 47.87632],
  [7.79097, 47.87662],
  [7.79003, 47.87656],
  [7.79005, 47.87673],
  [7.79001, 47.8768],
  [7.78989, 47.87689],
  [7.78955, 47.87733],
  [7.78924, 47.87755],
  [7.78899, 47.87793],
  [7.78881, 47.87806],
  [7.78855, 47.87831],
  [7.78843, 47.87846],
  [7.78823, 47.87878],
  [7.78813, 47.87882],
  [7.78804, 47.87881],
  [7.78767, 47.8787],
  [7.78719, 47.87851],
  [7.78698, 47.87846],
  [7.78566, 47.87828],
  [7.78523, 47.87825],
  [7.78524, 47.87802],
  [7.78517, 47.8778],
  [7.78512, 47.8777],
  [7.78496, 47.87754],
  [7.78483, 47.87734],
  [7.78467, 47.87703],
  [7.78466, 47.8769],
  [7.78445, 47.87675],
  [7.78402, 47.8765],
  [7.78342, 47.876],
  [7.78314, 47.87573],
  [7.783, 47.87562],
  [7.78284, 47.87555],
  [7.78274, 47.87548],
  [7.78251, 47.87543],
  [7.78212, 47.87522],
  [7.78192, 47.87516],
  [7.78095, 47.87513],
  [7.78079, 47.87515],
  [7.78048, 47.87523],
  [7.78042, 47.87526],
  [7.78009, 47.87532],
  [7.7794, 47.87535],
  [7.77904, 47.87545],
  [7.77876, 47.8755],
  [7.77821, 47.87552],
  [7.77809, 47.87555],
  [7.77788, 47.87541],
  [7.77777, 47.87524],
  [7.77771, 47.875],
  [7.77774, 47.87465],
  [7.7777, 47.87438],
  [7.77767, 47.87424],
  [7.77756, 47.87394],
  [7.77742, 47.87382],
  [7.77722, 47.87377],
  [7.77665, 47.87371],
  [7.77652, 47.87366],
  [7.77642, 47.87359],
  [7.77629, 47.87348],
  [7.77612, 47.87312],
  [7.77611, 47.87273],
  [7.77608, 47.87264],
  [7.77603, 47.87261],
  [7.77561, 47.87257],
  [7.77532, 47.87261],
  [7.77522, 47.87265],
  [7.77461, 47.87317],
  [7.77451, 47.87319],
  [7.77396, 47.87323],
  [7.7735, 47.87323],
  [7.77307, 47.8732],
  [7.77279, 47.87325],
  [7.77231, 47.87365],
  [7.77217, 47.87374],
  [7.77123, 47.87417],
  [7.77084, 47.87439],
  [7.77059, 47.8746],
  [7.77007, 47.87495],
  [7.76996, 47.87506],
  [7.76979, 47.87533],
  [7.76962, 47.87551],
  [7.76932, 47.87576],
  [7.76908, 47.87588],
  [7.7687, 47.876],
  [7.76831, 47.87609],
  [7.76775, 47.87616],
  [7.76757, 47.87628],
  [7.76732, 47.87653],
  [7.76707, 47.8767],
  [7.7664, 47.87694],
  [7.76618, 47.87704],
  [7.76604, 47.87716],
  [7.76551, 47.8772],
  [7.76536, 47.87723],
  [7.76515, 47.87722],
  [7.76491, 47.87717],
  [7.76445, 47.87712],
  [7.76418, 47.87706],
  [7.76338, 47.87702],
  [7.76309, 47.87695],
  [7.76264, 47.87692],
  [7.7623, 47.87682],
  [7.76196, 47.87677],
  [7.76156, 47.87693],
  [7.76129, 47.87709],
  [7.76109, 47.87713],
  [7.76075, 47.87714],
  [7.76002, 47.87709],
  [7.75971, 47.87703],
  [7.7593, 47.87691],
  [7.75897, 47.877],
  [7.75868, 47.87704],
  [7.75838, 47.87711],
  [7.75821, 47.87709],
  [7.75796, 47.87716],
  [7.7578, 47.87718],
  [7.7577, 47.87718],
  [7.7577, 47.87713],
  [7.75765, 47.87712],
  [7.75693, 47.87725],
  [7.75616, 47.87735]
].map(([lon,lat]) => ([lat,lon]));

const invert = (agg,n) => ([n, ...agg]);
const trail = [
  ...coords,
  ...coords.reduce(invert,[]),
  ...coords,
  ...coords.reduce(invert,[]),
  ...coords,
  ...coords.reduce(invert,[])
]

window.testing.GPS.mock();
window.testing.GPS.update(trail);

// START Android back button disable
function disableBackButton() {
  document.addEventListener(
    'backbutton',
    event => {
      event.preventDefault();
      event.stopPropagation();
    },
    false
  );
}
setupConfig({
  hardwareBackButton: false,
});
// END Android back button disable

async function init() {
  await appModel._init;
  await userModel._init;
  await savedSamples._init;
  Analytics.init();

  if (window.cordova) {
    document.addEventListener(
      'deviceready',
      () => {
        if (navigator && navigator.splashscreen) {
          navigator.splashscreen.hide();
        }
      },
      false
    );

    disableBackButton();
  }

  ReactDOM.render(<App />, document.getElementById('root'));
}

init();
